import{i as o}from"./main-ABW9teLg.js";const s=class s{constructor(){this.subscribers=new Map,this.currentPosition=null,this.isListening=!1,this.rafId=null,this.handleMouseMove=this.handleMouseMove.bind(this)}static getInstance(){return s.instance||(s.instance=new s),s.instance}subscribe(i){if(o())return()=>{};const t={subscription:i,lastCallTime:0,timeoutId:null};return this.subscribers.set(i.id,t),this.isListening||this.startListening(),this.currentPosition&&setTimeout(()=>{this.subscribers.has(i.id)&&this.callSubscriber(t)},0),()=>{this.unsubscribe(i.id)}}unsubscribe(i){const t=this.subscribers.get(i);t!=null&&t.timeoutId&&clearTimeout(t.timeoutId),this.subscribers.delete(i),this.subscribers.size===0&&this.stopListening()}startListening(){this.isListening||o()||(document.addEventListener("mousemove",this.handleMouseMove),this.isListening=!0,this.loadGlobalPosition())}stopListening(){this.isListening&&(document.removeEventListener("mousemove",this.handleMouseMove),this.isListening=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null))}handleMouseMove(i){const t={x:i.clientX,y:i.clientY};this.currentPosition=t,this.saveGlobalPosition(),this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.notifySubscribers(),this.rafId=null}))}notifySubscribers(){if(!this.currentPosition)return;const i=Date.now();this.subscribers.forEach(t=>{const{subscription:n,lastCallTime:r,timeoutId:l}=t,{throttleMs:a=0}=n;if(a>0){const h=i-r;h>=a?this.callSubscriber(t):(l&&clearTimeout(l),t.timeoutId=setTimeout(()=>{this.callSubscriber(t),t.timeoutId=null},a-h))}else this.callSubscriber(t)})}callSubscriber(i){this.currentPosition&&(i.subscription.callback(this.currentPosition),i.lastCallTime=Date.now())}loadGlobalPosition(){try{const i=window.__mouseTrackerPosition__;i&&typeof i.x=="number"&&typeof i.y=="number"&&(this.currentPosition=i)}catch{}}saveGlobalPosition(){if(this.currentPosition)try{window.__mouseTrackerPosition__={...this.currentPosition}}catch{}}getCurrentPosition(){return this.currentPosition?{...this.currentPosition}:null}getSubscriberCount(){return this.subscribers.size}static resetInstance(){s.instance&&(s.instance.stopListening(),s.instance=null)}};s.instance=null;let u=s;const e=class e{constructor(){this.subscribers=new Map,this.currentGlobalPosition=null,this.isListening=!1,this.rafId=null,this.mouseTracker=u.getInstance(),this.handleLayoutChange=this.handleLayoutChange.bind(this)}static getInstance(){return e.instance||(e.instance=new e),e.instance}subscribe(i){if(o())return()=>{};const t={subscription:i,lastCallTime:0,timeoutId:null};this.subscribers.set(i.id,t),this.isListening||this.startListening();const n=this.mouseTracker.subscribe({id:`coordinator-${i.id}`,callback:r=>{this.updateGlobalPosition(r),this.notifyPositionChange(i.id,r)},throttleMs:i.throttleMs});return()=>{n(),this.unsubscribe(i.id)}}unsubscribe(i){const t=this.subscribers.get(i);t!=null&&t.timeoutId&&clearTimeout(t.timeoutId),this.subscribers.delete(i),this.subscribers.size===0&&this.stopListening()}startListening(){this.isListening||o()||(document.addEventListener("scroll",this.handleLayoutChange,!0),window.addEventListener("resize",this.handleLayoutChange),this.isListening=!0)}stopListening(){this.isListening&&(document.removeEventListener("scroll",this.handleLayoutChange,!0),window.removeEventListener("resize",this.handleLayoutChange),this.isListening=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null))}handleLayoutChange(){this.rafId===null&&(this.rafId=requestAnimationFrame(()=>{this.notifyAllSubscribersWithCurrentPosition(),this.rafId=null}))}updateGlobalPosition(i){this.currentGlobalPosition=i}notifyPositionChange(i,t){const n=this.subscribers.get(i);n&&n.subscription.onPositionChange(t)}notifyAllSubscribersWithCurrentPosition(){this.currentGlobalPosition&&this.subscribers.forEach(i=>{i.subscription.onPositionChange(this.currentGlobalPosition)})}getSubscriberCount(){return this.subscribers.size}static resetInstance(){e.instance&&(e.instance.stopListening(),e.instance=null)}};e.instance=null;let c=e;export{c as CursorCoordinator};
